{% if user.is_superuser %}{% load bootstrap3 %}
                  <li class="dropdown app-menu"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Création<b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li><a href="#" id="new-sujet">{% bootstrap_icon "user" %} Nouveau sujet</a></li>
                    <li><a href="#" id="new-lieu">{% bootstrap_icon "globe" %} Nouveau lieu</a></li>
                  </ul>
{% endif %}

<script type="text/javascript">
    /* Lier les boutons de création
    *  Thanks to Derek Morgan, https://dmorgan.info/posts/django-views-bootstrap-modals/
    */
  $(function() {

    var formAjaxSubmit = function(form, modal) {
     $(form).submit(function (e) {
         e.preventDefault();
         $.ajax({
             type: $(this).attr('method'),
             url: $(this).attr('action'),
             data: $(this).serialize(),
             success: function (xhr, ajaxOptions, thrownError) {
                 if ( $(xhr).find('.has-error').length > 0 || $(xhr).find('.alert-danger').length > 0) {
                     $(modal).find('.modal-body').html(xhr);
                     formAjaxSubmit(form, modal);
                 } else {
                     $(modal).modal('toggle');
                    // Reload page ?
                      location.reload(true)
                 }
             },
             error: function (xhr, ajaxOptions, thrownError) {
                 // handle response errors here
             }
         });
      });
    };
  /* TODO: Use formAjaxSubmit above, but reload page on form success */
     $('#new-sujet').click(function() {
         $('#form-modal-body').load('{% url "sujets:create" %}?next={% url "maraudes:create" pk=maraude.id %}', function () {
            $('.modal-title').text("Nouveau sujet");
            $('#form-modal').modal('toggle');
            formAjaxSubmit("#form-modal-body form", "#form-modal");
         });
     });
    $('#new-lieu').click(function() {

         $('#form-modal-body').load('{% url "maraudes:lieu-create" %}?next={% url "maraudes:create" pk=maraude.id %}', function () {
            $('.modal-title').text("Nouveau lieu");
            $('#form-modal').modal('toggle');
            formAjaxSubmit("#form-modal-body form", "#form-modal");
         });
     });
  });
</script>
        
