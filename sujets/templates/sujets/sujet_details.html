<div class="panel panel-primary">
  <div class="panel-heading" role="tab" id="ficheInfoHeading">
    <div class="row">
      <div class="col-md-9">
        <h4 class="panel-title">
          <a role="button" data-toggle="collapse" href="#collapseFicheInfo" aria-expanded="true" aria-controls="collapseOne">
          Fiche informations</a>
        </h4>
      </div>
      <div class="col-md-3 text-right">
        <a href="#" class="btn btn-sm btn-primary" id="updateButton">Mettre Ã  jour</a>
      </div>
    </div>
  </div>
  <div id="collapseFicheInfo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="ficheInfoHeading">
    {% include 'sujets/sujet_details_inner.html' %}
  </div>
</div>
<script type="text/javascript">
  $(function() {
    var formAjaxSubmit = function(form, panel) {
     $(form).submit(function (e) {
         e.preventDefault();
         $.ajax({
             type: $(this).attr('method'),
             url: $(this).attr('action'),
             data: $(this).serialize(),
             success: function (xhr, ajaxOptions, thrownError) {
                 if ( $(xhr).find('.has-error').length > 0 || $(xhr).find('.alert-danger').length > 0) {
                     $(panel).html(xhr);
                     formAjaxSubmit(form, panel);
                 } else {
                    $(panel).load("{% url "sujets:details" pk=sujet.id %}")
                 }
             },
             error: function (xhr, ajaxOptions, thrownError) {
                 // handle response errors here
             }
         });
      });
    };
  /* TODO: Use formAjaxSubmit above, but reload page on form success */
     $('#updateButton').click(function() {
          var panel = $('#collapseFicheInfo')
          panel.load('{% url "sujets:update" pk=sujet.pk %}?next={% url "suivi:details" pk=sujet.id %}', function () {
            formAjaxSubmit(panel.find("form"), panel);
            panel.collapse('show');
         });
     });

  });
</script>
